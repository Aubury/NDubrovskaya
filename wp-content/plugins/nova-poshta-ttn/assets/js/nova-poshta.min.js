jQuery(document).ready(function(){if(document.getElementById("billing_nova_poshta_city")){var o={action:"novaposhta_updbasesnp",c2:jQuery("#billing_nova_poshta_city").val(),cod:jQuery("#payment_method_cod").attr("checked")};function e(){console.log("calculatex");var o={action:"my_actionfogetnpshippngcost",c2:jQuery("#billing_nova_poshta_city").val(),cod:jQuery("#payment_method_cod").attr("checked")};jQuery.post(NovaPoshtaHelper.ajaxUrl,o,function(o){jQuery("#shipcost").remove(),o.includes("01234")||0==o?console.log("shipping calculation not available. "):(jQuery(".order-total").after('<tr id=shipcost class=order-total><th>Розрахунок вартості доставки</th><td><strong><span class="woocommerce-Price-currencySymbol">₴</span>'+o+'<strong><input type="hidden" name=deliveryprice value="'+o+'"/ ></td></tr>'),console.log(o))})}jQuery.post(NovaPoshtaHelper.ajaxUrl,o,function(o){console.log(o)}),jQuery("#billing_nova_poshta_city").change(function(){e()}),jQuery("body").on("click",".wc_payment_method",function(){console.log("changed payment method"),setTimeout(function(){e()},20),setTimeout(function(){e()},500),setTimeout(function(){e()},4e3)}),jQuery("body").on("click",".shipping_method",function(){console.log("changed shipping method"),console.log(jQuery(this).val()),"nova_poshta_shipping_method"==jQuery(this).val()?(e(),setTimeout(function(){e()},500),setTimeout(function(){e()},4e3)):jQuery("#shipcost").remove()});var t={matcher:function(o,e){if(""===jQuery.trim(o.term))return e;if(void 0===e.text)return null;var t=jQuery.trim(o.term).toLowerCase();return t===jQuery.trim(e.text).toLowerCase().substr(0,t.length)?e:null},minimumInputLength:2,maximumDisplayOptionsLength:50,templateResult:function(o){return o.loading?o.text:(o.id=o.id,o.code,o.text)},templateSelection:function(o){return o.text},language:{errorLoading:function(){return"Завантаження."},inputTooShort:function(){return"Введіть більше символів..."},noResults:function(){return"Нічого не знайдено"},searching:function(){return"Пошук…"}}};jQuery("#billing_nova_poshta_city").select2(t),jQuery("#shipping_nova_poshta_city").select2(t),jQuery("#billing_nova_poshta_warehouse").select2(),jQuery("#billing_nova_poshta_region").select2(),jQuery("#shipping_nova_poshta_warehouse").select2(),jQuery("#shipping_nova_poshta_region").select2(),jQuery("#billing_nova_poshta_region").on("change",function(){jQuery("#billing_nova_poshta_city").select2("val",""),jQuery("#billing_nova_poshta_warehouse").select2("val","")}),jQuery("#billing_nova_poshta_city").on("change",function(){jQuery("#billing_nova_poshta_warehouse").select2("val","")}),jQuery("#shipping_nova_poshta_region").on("change",function(){jQuery("#shipping_nova_poshta_city").select2("val",""),jQuery("#shipping_nova_poshta_warehouse").select2("val","")}),jQuery("#shipping_nova_poshta_city").on("change",function(){jQuery("#shipping_nova_poshta_warehouse").select2("val","")})}var n,i,a,r,s,c,p,l,h,u,_,d,g,v,f,m,y,j,b,Q,w,x,N=(n=jQuery,i={},a=n("#billing_nova_poshta_region, #billing_nova_poshta_city, #billing_nova_poshta_warehouse"),r=n("#billing_nova_poshta_region"),s=n("#billing_nova_poshta_city"),c=n("#billing_nova_poshta_warehouse"),p=n("#shipping_nova_poshta_region, #shipping_nova_poshta_city, #shipping_nova_poshta_warehouse"),l=n("#shipping_nova_poshta_region"),h=n("#shipping_nova_poshta_city"),u=n("#shipping_nova_poshta_warehouse"),_="justin_shipping_method, nova_poshta_shipping_method",d=n("#billing_address_1, #billing_address_2, #billing_city, #billing_state, #billing_postcode"),g=n("#shipping_address_1, #shipping_address_2, #shipping_city, #shipping_state, #shipping_postcode"),v=n("input[name^=shipping_method]"),f=n("#ship-to-different-address-checkbox"),m=function(){_.includes(j())||d.each(function(){n(this).removeAttr("disabled").closest(".form-row").show()})},y=function(){_.includes(j())?d.each(function(){n(this).attr("disabled","disabled").closest(".form-row").hide()}):console.log("shippingMethods notincludes")},j=function(){var o=n("input[name^=shipping_method][type=radio]:checked").val();return o||(o=n("input#shipping_method_0").val()),o||(o=n("input[name^=shipping_method][type=hidden]").val()),o},b=function(){g.each(function(){n(this).removeAttr("disabled").closest(".form-row").show()})},Q=function(){g.each(function(){n(this).attr("disabled","disabled").closest(".form-row").hide()})},w=function(){a.each(function(){n(this).attr("disabled","disabled").closest(".form-row").hide()}),m(),p.each(function(){n(this).attr("disabled","disabled").closest(".form-row").hide()}),b()},x=function(){var o;w(),(o=n("input[name^=shipping_method][type=radio]:checked").val())||(o=n("input#shipping_method_0").val()),o||(o=n("input[name^=shipping_method][type=hidden]").val()),o||jQuery.post(NovaPoshtaHelper.ajaxUrl,{action:"my_action_for_wc_get_chosen_method_ids"},function(e){o=e}),(jQuery("#billing_country").val()&&"UA"!=jQuery("#billing_country").val()?(console.log("185: return false"),0):!o||"nova_poshta_shipping_method"===o)&&(f.is(":checked")?(p.each(function(){n(this).removeAttr("disabled").closest(".form-row").show()}),Q()):(a.each(function(){n(this).removeAttr("disabled").closest(".form-row").show()}),y()))},i.init=function(){n(document).on("change",v,function(){x()}),n(document).on("change",f,function(){x()}),n(document.body).bind("updated_checkout",function(){x()}),x(),r.on("change",function(){var o=this.value;n.ajax({url:NovaPoshtaHelper.ajaxUrl,method:"POST",data:{action:NovaPoshtaHelper.getCitiesAction,parent_ref:o},success:function(o){try{var e=JSON.parse(o);s.find("option:not(:first-child)").remove(),n.each(e,function(o,e){s.append(n("<option></option>").attr("value",o).text(e))}),c.find("option:not(:first-child)").remove()}catch(e){console.log("Error. Response from server was: "+o)}},error:function(){console.log("Error.")}})}),s.on("change",function(){var o=this.value;n.ajax({url:NovaPoshtaHelper.ajaxUrl,method:"POST",data:{action:NovaPoshtaHelper.getWarehousesAction,parent_ref:o},success:function(o){try{var e=JSON.parse(o);c.find("option:not(:first-child)").remove(),n.each(e,function(o,e){c.append(n("<option></option>").attr("value",o).text(e))})}catch(e){console.log("Error. Response from server was: "+o)}},error:function(){console.log("Error.")}})}),l.on("change",function(){var o=this.value;n.ajax({url:NovaPoshtaHelper.ajaxUrl,method:"POST",data:{action:NovaPoshtaHelper.getCitiesAction,parent_ref:o},success:function(o){try{var e=JSON.parse(o);h.find("option:not(:first-child)").remove(),n.each(e,function(o,e){h.append(n("<option></option>").attr("value",o).text(e))}),u.find("option:not(:first-child)").remove()}catch(e){console.log("Error. Response from server was: "+o)}},error:function(){console.log("Error.")}})}),h.on("change",function(){var o=this.value;n.ajax({url:NovaPoshtaHelper.ajaxUrl,method:"POST",data:{action:NovaPoshtaHelper.getWarehousesAction,parent_ref:o},success:function(o){try{var e=JSON.parse(o);u.find("option:not(:first-child)").remove(),n.each(e,function(o,e){u.append(n("<option></option>").attr("value",o).text(e))})}catch(e){console.log("Error. Response from server was: "+o)}},error:function(){console.log("Error.")}})})},i),P=function(o){var e={},t=function(){var e=o("input[name^=shipping_method][type=radio]:checked").val();return e||(e=o("input#shipping_method_0").val()),"nova_poshta_shipping_method"===e},n=function(){o("#calc_shipping_country").find("option").each(function(){"UA"!==o(this).val()&&o(this).remove()}),o("#calc_shipping_state_field").hide();var e=o('<input type="hidden" id="calc_nova_poshta_shipping_method" value="nova_poshta_shipping_method" name="shipping_method">'),t=o('<input type="hidden" id="calc_nova_poshta_shipping_city" name="calc_nova_poshta_shipping_city">');o("#calc_shipping_city_field").append(t).append(e);var n=o("#calc_shipping_city");n.autocomplete({source:function(o,e){jQuery.ajax({type:"POST",url:NovaPoshtaHelper.ajaxUrl,data:{action:NovaPoshtaHelper.getCitiesByNameSuggestionAction,name:o.term},success:function(o){var t=JSON.parse(o);e(jQuery.map(t,function(o,e){return{label:o,value:e}}))}})},focus:function(o,e){return n.val(e.item.label),!1},select:function(o,e){return n.val(e.item.label),t.val(e.item.value),!1}}),o("form.woocommerce-shipping-calculator").on("submit",function(){if("UA"!==o("#calc_shipping_country").val())return!1})};return e.init=function(){o(document.body).bind("updated_wc_div updated_shipping_method",function(){t()&&n()}),t()&&n()},e}(jQuery);N.init(),P.init(),setTimeout(function(){jQuery("#billing_country").trigger("change",[])},600)});
